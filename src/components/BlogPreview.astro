---
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

const recentPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()).slice(0, 3);
---

<section id="blog" class="section">
  <div class="header">
      <h2 class="section-title">Latest Updates</h2>
      <a href="/blog" class="view-all">View All Posts &rarr;</a>
  </div>
  
  <div class="blog-grid">
    {recentPosts.map((post) => (
      <article class="blog-card">
        <a href={`/blog/${post.slug}`}>
            <div class="card-image">
                <img src={post.data.image || "https://via.placeholder.com/600x400"} alt={post.data.title} />
            </div>
            <div class="card-content">
                <span class="date">{post.data.date.toLocaleDateString()}</span>
                <h3>{post.data.title}</h3>
                <p class="summary">{post.data.summary}</p>
                <span class="read-more">Read Article</span>
            </div>
        </a>
      </article>
    ))}
  </div>
</section>

<style>
  .section { padding: var(--spacing-lg) 0; }

  .header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: var(--spacing-md);
  }
  
  .view-all {
      color: var(--color-primary);
      font-weight: 600;
  }

  .blog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--spacing-md);
  }

  .blog-card {
    transition: transform 0.2s;
  }
  
  .blog-card:hover {
      transform: translateY(-5px);
  }
  
  .card-image {
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: var(--spacing-sm);
      aspect-ratio: 16/9;
  }
  
   .card-image img {
       width: 100%;
       height: 100%;
       object-fit: cover;
   }

  .date {
      font-size: 0.85rem;
      color: var(--color-text-muted);
  }

  .card-content h3 {
      font-size: 1.25rem;
      margin: 0.5rem 0;
  }

  .summary {
      color: var(--color-text-muted);
      font-size: 0.95rem;
      margin-bottom: var(--spacing-sm);
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
  }
  
  .read-more {
      color: var(--color-primary);
      font-weight: 600;
      font-size: 0.9rem;
  }
</style>
